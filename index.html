<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Autodance Share Online</title>
<style>
/* Fonte Tungsten Bold */
@font-face {
    font-family: 'TungstenBold';
    src: url('Tungsten-Bold.ttf') format('truetype');
}
body {
    font-family: Arial, sans-serif;
    background: url('IMG_2223.jpeg') no-repeat center center fixed;
    background-size: cover;
    color:#f0f0f0;
    margin:0;
    padding:0;
}
header {
    font-family: 'TungstenBold', Arial, sans-serif;
    font-weight: normal;
    background: rgba(255,77,77,0.3);
    padding: 1.2em;
    text-align: center;
    font-size: 2.2em;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    border-radius: 0 0 12px 12px;
}
main {
    max-width: 900px;
    margin: 2em auto;
    padding: 2em;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    border-radius: 16px;
}
h2 {
    margin-top:1.5em;
    color:#ffbb33;
}
input, button {
    font-size:1em;
    border-radius:12px;
    border:none;
    padding:0.8em;
    margin-bottom:0.5em;
}
input[type="text"], input[type="url"], input[type="email"], input[type="password"] {
    width:100%;
    background: rgba(255,255,255,0.1);
    color:#fff;
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(6px);
    transition: border 0.3s, background 0.3s;
}
input::placeholder {
    color:#ccc;
}
input:focus {
    border:1px solid #ffbb33;
    background: rgba(255,255,255,0.2);
    outline:none;
}
button {
    background: linear-gradient(135deg, #ff4d4d, #ffbb33);
    color: #fff;
    font-weight: bold;
    cursor:pointer;
    transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
    padding:0.8em 1.5em;
}
button:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(255,187,51,0.6);
    background: linear-gradient(135deg, #ffbb33, #ff4d4d);
}
.post {
    background: rgba(30,30,30,0.4);
    backdrop-filter: blur(8px);
    padding:1em;
    border-radius:12px;
    margin-bottom:1em;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
}
.post:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.6);
}
.author {
    font-weight:bold;
    color:#ffbb33;
    margin-bottom:0.5em;
}
.video-container {
    position:relative;
    width:100%;
    height:0;
    padding-bottom:56.25%;
    margin-top:0.5em;
}
.video-container iframe {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    border:none;
    border-radius:8px;
}
.delete-btn {
    margin-top:0.5em;
    background:#ff5555;
    color:#fff;
    border:none;
    padding:0.5em 1em;
    border-radius:8px;
    cursor:pointer;
    transition: background 0.3s, transform 0.2s;
}
.delete-btn:hover {
    background:#e04343;
    transform: scale(1.05);
}
.post.own {
    border: 2px solid #ffbb33;
}
.tag-box {
    font-family: 'TungstenBold', Arial, sans-serif;
    display: inline-block;
    background: rgba(255,187,51,0.2);
    color: #ffbb33;
    padding: 4px 10px;
    margin: 3px 3px 0 0;
    border-radius: 8px;
    font-size: 0.85em;
}
#searchInput {
    width:100%;
    padding:0.8em;
    margin-bottom:1em;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.1);
    color:#fff;
}
#searchInput:focus {
    outline:none;
    border:1px solid #ffbb33;
}
/* MÃºsica */
#musicName {
    font-family: 'TungstenBold', Arial, sans-serif;
    position: fixed;
    bottom: 20px;
    left: 20px;
    font-size: 1.4em;
    color: #ffbb33;
    background: rgba(0,0,0,0.5);
    padding: 6px 12px;
    border-radius: 12px;
}
</style>
</head>
<body>
<header>Autodance Share Online</header>
<main>

<h2>Login / Registro</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">
<button id="loginBtn">Login / Criar conta</button>

<h2>Poste sua autodance</h2>
<input type="text" id="author" placeholder="Seu nome" disabled>
<input type="url" id="videoUrl" placeholder="Cole o embed do Streamable (src)" disabled>
<input type="text" id="tags" placeholder="Tags (ex: Just Dance 2015, Solo, Funk)" disabled>
<input type="text" id="musicNameInput" placeholder="Nome da mÃºsica" disabled>
<button id="postBtn" disabled>Postar</button>

<h2>Pesquisar por tag</h2>
<input type="text" id="searchInput" placeholder="Pesquisar tag...">

<h2>Autodances enviadas</h2>
<div id="posts"></div>
</main>

<!-- Exibe mÃºsica -->
<div id="musicName">Nenhuma mÃºsica</div>

<!-- Tela de SeleÃ§Ã£o de Avatar -->
<div id="avatarSelection" style="
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.95);
    display:flex; flex-wrap: wrap; justify-content: center; align-items: center;
    overflow-y: auto; z-index: 9999;
"></div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, onValue, set, push, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCA2XWZzavTNdHi_w8X5aASfBTfoLVsghY",
  authDomain: "auto-dance.firebaseapp.com",
  databaseURL: "https://auto-dance-default-rtdb.firebaseio.com",
  projectId: "auto-dance",
  storageBucket: "auto-dance.firebasestorage.app",
  messagingSenderId: "960760470726",
  appId: "1:960760470726:web:f5af55d01df6a2be0d4bc7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const emailInput = document.getElementById("email");
const senhaInput = document.getElementById("senha");
const loginBtn = document.getElementById("loginBtn");
const authorInput = document.getElementById("author");
const videoInput = document.getElementById("videoUrl");
const tagsInput = document.getElementById("tags");
const postBtn = document.getElementById("postBtn");
const postsContainer = document.getElementById("posts");
const searchInput = document.getElementById("searchInput");
const musicNameInput = document.getElementById("musicNameInput");
const musicNameDisplay = document.getElementById("musicName");

let currentUser = null;

// Palavras imprÃ³prias
const blockedWords = ["puta","merda","caralho","bosta","porra","foda","fodase","fuck","shit","bitch","asshole","damn","dick","piss","crap","cunt","coÃ±o","gilipollas","joder","cabron","merde","putain","con","connard","salope","bordel","nigger","nigga","slut","whore","fag","retard"];

// Login / criar conta
loginBtn.addEventListener("click", async ()=>{
    const email = emailInput.value.trim();
    const senha = senhaInput.value.trim();
    if(!email||!senha){alert("Preencha email e senha!"); return;}
    try{ await signInWithEmailAndPassword(auth,email,senha); }
    catch(e){ 
        try{ await createUserWithEmailAndPassword(auth,email,senha); }
        catch(err){ alert(err.message); return; }
    }
});

// Detecta login
onAuthStateChanged(auth,user=>{
    if(user){
        currentUser=user;
        authorInput.value = user.email.split("@")[0];
        authorInput.disabled=false;
        videoInput.disabled=false;
        tagsInput.disabled=false;
        postBtn.disabled=false;
        musicNameInput.disabled=false;
        loginBtn.disabled=true;
        emailInput.disabled=true;
        senhaInput.disabled=true;
        loadPosts();
        loadUserAvatar();
    } else {
        currentUser=null;
        authorInput.disabled=true;
        videoInput.disabled=true;
        tagsInput.disabled=true;
        postBtn.disabled=true;
        musicNameInput.disabled=true;
        loginBtn.disabled=false;
        emailInput.disabled=false;
        senhaInput.disabled=false;
        postsContainer.innerHTML="";
    }
});

// Adiciona post
postBtn.addEventListener("click", async ()=>{
    const author = authorInput.value;
    const video = videoInput.value.trim();
    const music = musicNameInput.value.trim();
    let tags = tagsInput.value.trim().split(",").map(t=>t.trim()).filter(t=>t);
    if(!video.includes("streamable.com")){ alert("SÃ³ Ã© permitido Streamable!"); return;}
    if(tags.some(t=>blockedWords.some(w=>t.toLowerCase().includes(w)))){ alert("Tags imprÃ³prias nÃ£o sÃ£o permitidas!"); return;}
    const postRef = push(ref(db,"posts"));
    await set(postRef,{author,video,tags,uid:currentUser.uid,music});
    videoInput.value=""; tagsInput.value=""; musicNameInput.value="";
    musicNameDisplay.textContent = "Nenhuma mÃºsica";
});

// Carrega posts
function loadPosts(){
    onValue(ref(db,"posts"),snapshot=>{
        postsContainer.innerHTML="";
        const data = snapshot.val();
        if(!data) return;
        Object.entries(data).reverse().forEach(([key,post])=>{
            const div = document.createElement("div");
            div.className="post";
            if(post.uid===currentUser.uid) div.classList.add("own");
            div.innerHTML=`
                <div class="author">${post.author}:</div>
                <div class="video-container">
                    <iframe src="${post.video}" allowfullscreen></iframe>
                </div>
                <div class="music-display">ðŸŽµ ${post.music || ""}</div>
            `;
            if(post.tags&&post.tags.length){
                const tagsContainer=document.createElement("div");
                tagsContainer.style.marginTop="0.5em";
                post.tags.forEach(tag=>{
                    const tagBox=document.createElement("span");
                    tagBox.className="tag-box";
                    tagBox.textContent=tag;
                    tagsContainer.appendChild(tagBox);
                });
                div.appendChild(tagsContainer);
            }
            if(post.uid===currentUser.uid){
                const delBtn=document.createElement("button");
                delBtn.textContent="Excluir";
                delBtn.className="delete-btn";
                delBtn.onclick=()=>remove(ref(db,"posts/"+key));
                div.appendChild(delBtn);
            }
            postsContainer.appendChild(div);
        });
    });
}

// Filtrar pesquisa
searchInput.addEventListener("input", ()=>{
    const filter = searchInput.value.trim().toLowerCase();
    const posts = postsContainer.querySelectorAll(".post");
    posts.forEach(p=>{
        const tags = Array.from(p.querySelectorAll(".tag-box")).map(t=>t.textContent.toLowerCase());
        p.style.display = tags.some(t=>t.includes(filter)) ? "" : "none";
    });
});

// MÃºsica
musicNameInput.addEventListener("input", ()=>{
    musicNameDisplay.textContent = musicNameInput.value || "Nenhuma mÃºsica";
});

// Avatares
const avatars = [
  "danse_pop_version.png",
  "dont_you_worry_child.png",
  "feel_so_right.png",
  "feel_this_moment.png",
  "fine_china_extreme.png",
  "fine_china.png",
  "flashdance_what_a_feeling.png",
  "follow_the_leader.png",
  "gentleman_c1.png",
  "gentleman_c2.png",
  "gentleman_sweat.png",
  "get_lucky_p1.png",
  "get_lucky_p2.png",
  "ghostbusters_p1.png",
  "ghostbusters_p2.png",
  "ghostbusters_p3.png",
  "ghostbusters_p4.png",
  "ghostbusters_sweat.png",
  "gimme_gimme_gimme_a_man_after_midnight_on_stage.png",
  "gimme_gimme_gimme_a_man_after_midnight.png",
  "i_kissed_a_girl_sing_along.png",
  "i_kissed_a_girl_sweat.png",
  "i_kissed_a_girl.png",
  "i_need_your_love.png",
  "i_will_survive_on_stage.png",
  "i_will_survive.png",
  "in_the_summertime.png",
  "isidora.png",
  "its_you_sweat.png",
  "its_you.png",
  "just_a_gigolo_p1.png",
  "just_a_gigolo_p2.png",
  "just_dance_c1.png",
  "just_dance_c2.png",
  "just_dance_sing_along.png",
  "just_dance_sweat.png",
  "kiss_you_6player_p1.png",
  "kiss_you_p2.png",
  "kiss_you_p3.png",
  "limbo_p1.png",
  "limbo_p2.png",
  "love_boat.png",
  "maria.png",
  "miss_understood.png",
  "moskau_p1.png",
  "my_main_girl.png",
  "nitro_bot_p1.png",
  "nitro_bot_p2.png",
  "one_way_or_another_teenage_kicks.png",
  "pound_the_alarm_extreme.png",
  "pound_the_alarm_p3.png",
  "prince_ali_p4.png",
  "rich_girl.png",
  "roar.png",
  "rock_n_roll.png",
  "safe_and_sound_c1.png",
  "sexy_and_i_know_it.png",
  "she_wolf_falling_to_pieces.png",
  "starships_charleston_p1.png",
  "starships.png",
  "the_other_side.png",
  "the_way_p2.png",
  "the_world_is_ours.png",
  "timber_p1.png",
  "timber_p2.png",
  "troublemaker.png",
  "turn_up_the_love_p1.png",
  "turn_up_the_love_sumo_p3.png",
  "wake_me_up_c1.png",
  "wake_me_up_c2.png",
  "waking_up_in_vegas.png",
  "we_cant_stop.png",
  "what_about_love.png",
  "where_have_you_been.png",
  "wild.png",
  "ymca_p1.png",
  "ymca_p2.png",
  "ymca_p3.png",
  "ymca_p4.png"
];

const avatarDiv = document.getElementById("avatarSelection");
let currentUserAvatar = null;

avatars.forEach(name => {
    const img = document.createElement("img");
    img.src = `/Just dance avatars/${name}`;
    img.style.width = "100px";
    img.style.height = "100px";
    img.style.margin = "10px";
    img.style.cursor = "pointer";
    img.style.borderRadius = "12px";
    img.style.border = "2px solid transparent";
    img.onclick = async () => {
        if(currentUser){
            await set(ref(db, `users/${currentUser.uid}/avatar`), name);
            currentUserAvatar = name;
        }
        avatarDiv.style.display = "none";
        showUserAvatar();
    };
    avatarDiv.appendChild(img);
});

function showUserAvatar(){
    let avatarImg = document.getElementById("userAvatar");
    if(!avatarImg){
        avatarImg = document.createElement("img");
        avatarImg.id = "userAvatar";
        avatarImg.style.width = "80px";
        avatarImg.style.height = "80px";
        avatarImg.style.position = "fixed";
        avatarImg.style.top = "20px";
        avatarImg.style.right = "20px";
        avatarImg.style.borderRadius = "12px";
        document.body.appendChild(avatarImg);
    }
    if(currentUserAvatar) avatarImg.src = `/Just dance avatars/${currentUserAvatar}`;
}

function loadUserAvatar(){
    if(!currentUser) return;
    onValue(ref(db, `users/${currentUser.uid}/avatar`), snapshot=>{
        currentUserAvatar = snapshot.val();
        if(currentUserAvatar) avatarDiv.style.display="none";
        showUserAvatar();
    });
}
</script>
</body>
</html>