<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AUTODANCE SHARE ONLINE</title>
<style>
@font-face { font-family:'JustDance'; src:url('Just Dance Font Regular.ttf') format('truetype'); }

body {
    font-family: 'JustDance', Arial, sans-serif;
    background: url('IMG_2223.jpeg') no-repeat center center fixed;
    background-size: cover;
    margin:0; padding:0;
    color:#fff;
    overflow-x:hidden;
}

header {
    font-family:'JustDance', Arial,sans-serif;
    font-weight: normal;
    background: rgba(255,77,77,0.3);
    padding: 1em 1.5em;
    display:flex;
    align-items:center;
    justify-content: space-between;
    box-shadow:0 4px 6px rgba(0,0,0,0.3);
}

header h1 { 
    margin:0; 
    font-size:2.2em;
    letter-spacing:2px;
}

#hamburger {
    width:30px; height:20px; cursor:pointer; display:flex; flex-direction:column; justify-content:space-between;
}
#hamburger div { height:4px; background:#ffbb33; border-radius:2px; transition:0.3s; }

main {
    max-width:900px;
    margin:2em auto;
    padding:2em;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(8px);
    border-radius:16px;
}

h2 { color:#ffbb33; margin-top:1.5em; }

input, button {
    font-size:1em; border-radius:12px; border:none; padding:0.8em; margin-bottom:0.5em;
}
input[type="text"], input[type="url"], input[type="email"], input[type="password"] {
    width:100%;
    background: rgba(255,255,255,0.1);
    color:#fff;
    border:1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(6px);
    transition: border 0.3s, background 0.3s;
}
input::placeholder { color:#ccc; }
input:focus { border:1px solid #ffbb33; background: rgba(255,255,255,0.2); outline:none; }

button {
    background: linear-gradient(135deg,#ff4d4d,#ffbb33);
    color: #fff;
    font-weight:bold;
    cursor:pointer;
    transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
    padding:0.8em 1.5em;
}
button:hover {
    transform: scale(1.05);
    box-shadow:0 8px 20px rgba(255,187,51,0.6);
    background: linear-gradient(135deg,#ffbb33,#ff4d4d);
}

.post { background: rgba(30,30,30,0.4); backdrop-filter: blur(8px); padding:1em; border-radius:12px; margin-bottom:1em; box-shadow:0 8px 20px rgba(0,0,0,0.5); transition: transform 0.2s, box-shadow 0.2s; position: relative;}
.post:hover { transform: translateY(-3px); box-shadow:0 12px 28px rgba(0,0,0,0.6);}
.author { font-weight:bold; color:#ffbb33; margin-bottom:0.5em; display:flex; align-items:center; gap:8px;}
.author img { width:32px; height:32px; border-radius:50%; object-fit:cover; }
.video-container { position:relative; width:100%; height:0; padding-bottom:56.25%; margin-top:0.5em; }
.video-container iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; border-radius:8px;}
.delete-btn { margin-top:0.5em; background:#ff5555; color:#fff; border:none; padding:0.5em 1em; border-radius:8px; cursor:pointer; transition: background 0.3s, transform 0.2s;}
.delete-btn:hover { background:#e04343; transform: scale(1.05);}
.post.own { border:2px solid #ffbb33;}
.tag-box { font-family:'JustDance',Arial,sans-serif; display:inline-block; background:rgba(255,187,51,0.2); color:#ffbb33; padding:4px 10px; margin:3px 3px 0 0; border-radius:8px; font-size:0.85em; cursor:pointer; }

/* Avatar e menu */
#menuAvatar {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  margin: 1em 0;
}
#menuAvatar img {
  width: 100px; height: 100px;
  border-radius: 50%;
  border: 3px solid #ffbb33;
  object-fit: cover;
  box-shadow: 0 0 15px rgba(255, 187, 51, 0.6);
}
#menuAvatarName {
  font-family: 'JustDance', Arial, sans-serif;
  font-size: 1.6em;
  font-weight: bold;
  color: #ffbb33;
  text-align: center;
  text-shadow: 0 0 8px rgba(255, 187, 51, 0.7);
}
#menuXP {
  font-family:'JustDance',Arial,sans-serif;
  font-size:1.2em;
  font-weight:bold;
  color:#ffbb33;
  text-align:center;
}

/* Likes e views */
.likeBtn {
  display: flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, #ff5722, #ff9800);
  border: none;
  border-radius: 8px;
  padding: 8px 16px;
  font-size: 1em;
  font-weight: bold;
  color: #fff;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.likeBtn i { font-size: 1.2em; transition: color 0.3s; }
.likeBtn:hover { transform: scale(1.05); box-shadow: 0 0 10px rgba(255,87,34,0.6); }
.likeBtn.liked { background: linear-gradient(135deg, #ff1744, #ff5252); }
.likeCount, .viewsCount { font-size: 0.9em; color: #eee; font-weight: 600; }

/* Menu lateral */
#menuContent {
    position: fixed; top:0; right:-300px;
    width:250px; height:100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(6px);
    padding:1em;
    box-shadow: -4px 0 12px rgba(0,0,0,0.5);
    transition: right 0.3s;
    z-index: 1001;
}
#menuContent.show { right:0; }

#menuOverlay {
    position: fixed; top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(2px);
    opacity:0; pointer-events:none;
    transition: opacity 0.3s;
    z-index:1000;
}
#menuOverlay.show { opacity:1; pointer-events:auto; }

.menu-btn { display:block; margin-top:1em; background:#ffbb33; color:#000; width:100%; border-radius:8px; padding:0.6em; text-align:center; cursor:pointer;}
.menu-btn:hover { background:#ffdd66; }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
<header>
<h1>AUTODANCE SHARE ONLINE</h1>
<div id="hamburger"><div></div><div></div><div></div></div>
</header>

<div id="menuOverlay"></div>

<div id="menuContent">
    <h2>Perfil</h2>
    <div id="menuAvatar">
      <img src="" alt="Avatar">
      <span id="menuAvatarName"></span>
      <div id="menuXP">XP: 0</div>
    </div>
    <div>
        <h3>Alterar Avatar</h3>
        <div id="avatarListMenu"></div>
    </div>
    <button class="menu-btn" id="logoutBtn">Logout</button>
</div>

<main>
<h2>Login / Registro</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">
<button id="loginBtn">Login / Criar conta</button>

<h2>Escolha seu avatar</h2>
<div id="avatarList" style="display:flex; gap:8px; flex-wrap:wrap;"></div>

<h2>Poste sua autodance</h2>
<input type="text" id="author" placeholder="Seu nome" disabled>
<input type="url" id="videoUrl" placeholder="Cole o embed do Streamable (src)" disabled>
<input type="text" id="tags" placeholder="Tags (ex: Just Dance 2015, Solo, Funk)" disabled>
<button id="postBtn" disabled>Postar</button>

<h2>Pesquisar por tag</h2>
<input type="text" id="searchInput" placeholder="Pesquisar tag...">

<h2>Autodances enviadas</h2>
<div id="posts"></div>
</main>

<script type="module">
/* ============================
   FIREBASE (versão válida)
   ============================ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, push, set, onValue, get, remove, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCA2XWZzavTNdHi_w8X5aASfBTfoLVsghY",
  authDomain: "auto-dance.firebaseapp.com",
  databaseURL: "https://auto-dance-default-rtdb.firebaseio.com",
  projectId: "auto-dance",
  storageBucket: "auto-dance.firebasestorage.app",
  messagingSenderId: "960760470726",
  appId: "1:960760470726:web:f5af55d01df6a2be0d4bc7"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ============================
   ELEMENTOS
   ============================ */
const emailInput=document.getElementById("email");
const senhaInput=document.getElementById("senha");
const loginBtn=document.getElementById("loginBtn");
const authorInput=document.getElementById("author");
const videoInput=document.getElementById("videoUrl");
const tagsInput=document.getElementById("tags");
const postBtn=document.getElementById("postBtn");
const postsContainer=document.getElementById("posts");
const searchInput=document.getElementById("searchInput");
const avatarList=document.getElementById("avatarList");
const avatarListMenu=document.getElementById("avatarListMenu");
const menuAvatar=document.querySelector("#menuAvatar img");
const menuAvatarName=document.getElementById("menuAvatarName");
const menuXP=document.getElementById("menuXP");
const logoutBtn=document.getElementById("logoutBtn");
const hamburger=document.getElementById("hamburger");
const menuContent=document.getElementById("menuContent");
const menuOverlay=document.getElementById("menuOverlay");

let currentUser=null;
let selectedAvatar=null;
const blockedWords=["puta","merda","caralho","bosta","porra","foda","fodase","fuck","shit","bitch","asshole","damn","dick","piss","crap","cunt","coño","gilipollas","joder","cabron","merde","putain","con","connard","salope","bordel","nigger","nigga","slut","whore","fag","retard"];

/* ============================
   Avatares (lista — troque pelos seus arquivos)
   ============================ */
const avatarUrls = [
  // Exemplos — substitua por seus arquivos hospedados
  "https://i.pravatar.cc/150?img=12",
  "https://i.pravatar.cc/150?img=18",
  "https://i.pravatar.cc/150?img=21",
  // se tiver imagens no seu github, adicione: 
  // "https://raphamodelagem3d-lab.github.io/Login/avatar1.png",
];

/* Monta seleção de avatar em dois lugares */
function buildAvatarList(listEl){
    listEl.innerHTML = "";
    avatarUrls.forEach(url=>{
        const wrapper = document.createElement("div");
        wrapper.style.cursor = "pointer";
        const img = document.createElement("img");
        img.src = url;
        img.alt = "avatar";
        img.style.width = "64px";
        img.style.height = "64px";
        img.style.borderRadius = "50%";
        img.style.border = "2px solid rgba(255,187,51,0.6)";
        img.style.objectFit = "cover";
        img.addEventListener("click", ()=> updateUserAvatar(url));
        wrapper.appendChild(img);
        listEl.appendChild(wrapper);
    });
}
buildAvatarList(avatarList);
buildAvatarList(avatarListMenu);

/* Atualiza avatar — usa update para não sobrescrever nó do usuário */
async function updateUserAvatar(url){
    selectedAvatar=url;
    if(currentUser){
        try{
            await update(ref(db,"users/"+currentUser.uid), { avatar: selectedAvatar });
        }catch(e){
            console.error("Erro ao atualizar avatar:", e);
        }
    }
    menuAvatar.src = selectedAvatar || "";
    // Atualiza avatares dos posts do usuário localmente (cuidado: só muda a view)
    const posts = postsContainer.querySelectorAll(".post.own .author img");
    posts.forEach(img=> img.src = selectedAvatar);
}

/* ============================
   Login / criar conta
   ============================ */
loginBtn.addEventListener("click", async ()=>{
    const email=emailInput.value.trim();
    const senha=senhaInput.value.trim();
    if(!email||!senha){ alert("Preencha email e senha!"); return; }
    try{
        await signInWithEmailAndPassword(auth,email,senha);
    }catch(e){
        // tenta criar conta se não conseguir logar
        try{
            await createUserWithEmailAndPassword(auth,email,senha);
        }catch(err){
            alert(err.message || "Erro ao criar conta.");
            return;
        }
    }
});

/* ============================
   Adicionar XP (uso de get + update simples)
   ============================ */
async function addXP(amount){
    if(!currentUser) return;
    const xpRef = ref(db,"users/"+currentUser.uid+"/xp");
    try{
        const snap = await get(xpRef);
        const currentXP = snap.exists()? snap.val() : 0;
        await set(xpRef, currentXP + amount);
    }catch(e){
        console.error("Erro ao adicionar XP:", e);
    }
}

/* ============================
   Observa estado de autenticação
   ============================ */
onAuthStateChanged(auth, async user=>{
    if(user){
        currentUser = user;
        emailInput.disabled=true;
        senhaInput.disabled=true;
        loginBtn.disabled=true;
        authorInput.disabled=false;
        videoInput.disabled=false;
        tagsInput.disabled=false;
        postBtn.disabled=false;

        // carrega dados do usuário com proteção
        const userRef = ref(db,"users/"+user.uid);
        try{
            const snapshot = await get(userRef);
            let storedName = "";
            if(snapshot.exists()){
                const val = snapshot.val();
                storedName = val.name || "";
                if(val.avatar) {
                    selectedAvatar = val.avatar;
                    menuAvatar.src = selectedAvatar;
                }
                if(storedName){
                    authorInput.value = storedName;
                    authorInput.disabled = true;
                    menuAvatarName.textContent = storedName;
                } else {
                    menuAvatarName.textContent = "";
                }
            }
        }catch(e){
            console.error("Erro ao ler usuário:", e);
        }