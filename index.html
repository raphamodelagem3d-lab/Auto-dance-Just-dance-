<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Autodance Share Online</title>
<style>
/* Mantive todo seu CSS anterior */
@font-face { font-family:'TungstenBold'; src:url('Tungsten-Bold.ttf') format('truetype'); }
body{ font-family:Arial,sans-serif; background:url('IMG_2223.jpeg') no-repeat center center fixed; background-size:cover; color:#f0f0f0; margin:0; padding:0; }
header{ font-family:'TungstenBold',Arial,sans-serif; font-weight:normal; background:rgba(255,77,77,0.3); padding:1.2em; text-align:center; font-size:2.2em; text-transform:uppercase; letter-spacing:1.5px; box-shadow:0 4px 6px rgba(0,0,0,0.3); border-radius:0 0 12px 12px; }
main{ max-width:900px; margin:2em auto; padding:2em; background:rgba(0,0,0,0.3); backdrop-filter:blur(10px); border-radius:16px; }
h2{ margin-top:1.5em; color:#ffbb33; }
input,button{ font-size:1em; border-radius:12px; border:none; padding:0.8em; margin-bottom:0.5em; }
input[type="text"], input[type="url"], input[type="email"], input[type="password"]{ width:100%; background: rgba(255,255,255,0.1); color:#fff; border:1px solid rgba(255,255,255,0.2); backdrop-filter: blur(6px); transition: border 0.3s, background 0.3s;}
input::placeholder{ color:#ccc;}
input:focus{ border:1px solid #ffbb33; background: rgba(255,255,255,0.2); outline:none;}
button{ background:linear-gradient(135deg,#ff4d4d,#ffbb33); color:#fff; font-weight:bold; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s, background 0.3s; padding:0.8em 1.5em;}
button:hover{ transform: scale(1.05); box-shadow:0 8px 20px rgba(255,187,51,0.6); background:linear-gradient(135deg,#ffbb33,#ff4d4d);}
.post{ background: rgba(30,30,30,0.4); backdrop-filter: blur(8px); padding:1em; border-radius:12px; margin-bottom:1em; box-shadow:0 8px 20px rgba(0,0,0,0.5); transition: transform 0.2s, box-shadow 0.2s; position: relative;}
.post:hover{ transform: translateY(-3px); box-shadow:0 12px 28px rgba(0,0,0,0.6);}
.author{ font-weight:bold; color:#ffbb33; margin-bottom:0.5em; display:flex; align-items:center; gap:8px;}
.author img{ width:32px; height:32px; border-radius:50%; object-fit:cover; }
.video-container{ position:relative; width:100%; height:0; padding-bottom:56.25%; margin-top:0.5em;}
.video-container iframe{ position:absolute; top:0; left:0; width:100%; height:100%; border:none; border-radius:8px;}
.delete-btn{ margin-top:0.5em; background:#ff5555; color:#fff; border:none; padding:0.5em 1em; border-radius:8px; cursor:pointer; transition: background 0.3s, transform 0.2s;}
.delete-btn:hover{ background:#e04343; transform: scale(1.05);}
.post.own{ border:2px solid #ffbb33;}
.tag-box{ font-family:'TungstenBold',Arial,sans-serif; display:inline-block; background:rgba(255,187,51,0.2); color:#ffbb33; padding:4px 10px; margin:3px 3px 0 0; border-radius:8px; font-size:0.85em;}
#searchInput{ width:100%; padding:0.8em; margin-bottom:1em; border-radius:12px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color:#fff;}
#searchInput:focus{ outline:none; border:1px solid #ffbb33;}
</style>
</head>
<body>
<header>Autodance Share Online</header>
<main>
<h2>Login / Registro</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">
<button id="loginBtn">Login / Criar conta</button>

<h2>Poste sua autodance</h2>
<input type="text" id="author" placeholder="Seu nome" disabled>
<input type="url" id="avatarUrl" placeholder="Nome do avatar (ex: avatar1.png)" disabled>
<input type="url" id="videoUrl" placeholder="Cole o embed do Streamable (src)" disabled>
<input type="text" id="tags" placeholder="Tags (ex: Just Dance 2015, Solo, Funk)" disabled>
<button id="postBtn" disabled>Postar</button>

<h2>Pesquisar por tag</h2>
<input type="text" id="searchInput" placeholder="Pesquisar tag...">

<h2>Autodances enviadas</h2>
<div id="posts"></div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, push, set, onValue, remove, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCA2XWZzavTNdHi_w8X5aASfBTfoLVsghY",
  authDomain: "auto-dance.firebaseapp.com",
  databaseURL: "https://auto-dance-default-rtdb.firebaseio.com",
  projectId: "auto-dance",
  storageBucket: "auto-dance.firebasestorage.app",
  messagingSenderId: "960760470726",
  appId: "1:960760470726:web:f5af55d01df6a2be0d4bc7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const emailInput=document.getElementById("email");
const senhaInput=document.getElementById("senha");
const loginBtn=document.getElementById("loginBtn");
const authorInput=document.getElementById("author");
const avatarInput=document.getElementById("avatarUrl");
const videoInput=document.getElementById("videoUrl");
const tagsInput=document.getElementById("tags");
const postBtn=document.getElementById("postBtn");
const postsContainer=document.getElementById("posts");
const searchInput=document.getElementById("searchInput");

let currentUser=null;
const blockedWords=["puta","merda","caralho","bosta","porra","foda","fodase","fuck","shit","bitch","asshole","damn","dick","piss","crap","cunt","coño","gilipollas","joder","cabron","merde","putain","con","connard","salope","bordel","nigger","nigga","slut","whore","fag","retard"];

// Login / criar conta
loginBtn.addEventListener("click", async ()=>{
    const email=emailInput.value.trim();
    const senha=senhaInput.value.trim();
    if(!email||!senha){ alert("Preencha email e senha!"); return; }
    try{ await signInWithEmailAndPassword(auth,email,senha); }
    catch(e){ 
        try{ await createUserWithEmailAndPassword(auth,email,senha); }
        catch(err){ alert(err.message); return; }
    }
});

// Detecta login
onAuthStateChanged(auth, async user=>{
    if(user){
        currentUser=user;
        emailInput.disabled=true;
        senhaInput.disabled=true;
        loginBtn.disabled=true;
        authorInput.disabled=false;
        avatarInput.disabled=false;
        videoInput.disabled=false;
        tagsInput.disabled=false;
        postBtn.disabled=false;

        // Checa se usuário já tem nome/avatar
        const userRef = ref(db, "users/"+user.uid);
        const snapshot = await get(userRef);
        if(snapshot.exists()){
            const val = snapshot.val();
            if(val.name) authorInput.value = val.name;
            if(val.avatar) avatarInput.value = val.avatar;
        }

        loadPosts();
    } else {
        currentUser=null;
        emailInput.disabled=false;
        senhaInput.disabled=false;
        loginBtn.disabled=false;
        authorInput.disabled=true;
        avatarInput.disabled=true;
        videoInput.disabled=true;
        tagsInput.disabled=true;
        postBtn.disabled=true;
        postsContainer.innerHTML="";
    }
});

// Adiciona post
postBtn.addEventListener("click", async ()=>{
    if(!currentUser) return;
    const author = authorInput.value.trim();
    const avatarName = avatarInput.value.trim();
    const avatar = `https://raw.githubusercontent.com/raphamodelagem3d-lab/Login/main/${avatarName}`;
    const video = videoInput.value.trim();
    const tags = tagsInput.value.trim().split(",").map(t=>t.trim()).filter(t=>t);

    if(!author){ alert("Digite seu nome!"); return; }
    if(!avatarName){ alert("Digite o nome do avatar!"); return; }
    if(!video.includes("streamable.com")){ alert("Só vídeos do Streamable são permitidos!"); return; }
    if(tags.some(t=>blockedWords.some(w=>t.toLowerCase().includes(w)))){ alert("Tags impróprias não são permitidas!"); return; }

    // Salva nome/avatar no usuário se ainda não existir
    await set(ref(db,"users/"+currentUser.uid), {name: author, avatar: avatar});

    const postRef = push(ref(db,"posts"));
    await set(postRef,{author,avatar,video,tags,uid:currentUser.uid});

    videoInput.value=""; tagsInput.value="";
});

// Carrega posts
function loadPosts(){
    onValue(ref(db,"posts"),snapshot=>{
        postsContainer.innerHTML="";
        const data = snapshot.val();
        if(!data) return;
        Object.entries(data).reverse().forEach(([key,post])=>{
            const div=document.createElement("div");
            div.className="post";
            if(currentUser && post.uid===currentUser.uid) div.classList.add("own");
            div.innerHTML=`
                <div class="author"><img src="${post.avatar}" alt="avatar">${post.author}:</div>
                <div class="video-container"><iframe src="${post.video}" allowfullscreen></iframe></div>
            `;
            if(post.tags&&post.tags.length){
                const tagsContainer=document.createElement("div");
                tagsContainer.style.marginTop="0.5em";
                post.tags.forEach(tag=>{
                    const tagBox=document.createElement("span");
                    tagBox.className="tag-box";
                    tagBox.textContent=tag;
                    tagsContainer.appendChild(tagBox);
                });
                div.appendChild(tagsContainer);
            }
            if(currentUser && post.uid===currentUser.uid){
                const delBtn=document.createElement("button");
                delBtn.textContent="Excluir";
                delBtn.className="delete-btn";
                delBtn.onclick=()=> remove(ref(db,"posts/"+key));
                div.appendChild(delBtn);
            }
            postsContainer.appendChild(div);
        });
    });
}

// Filtrar pesquisa
searchInput.addEventListener("input", ()=>{
    const filter=searchInput.value.trim().toLowerCase();
    const posts=postsContainer.querySelectorAll(".post");
    posts.forEach(p=>{
        const tags=Array.from(p.querySelectorAll(".tag-box")).map(t=>t.textContent.toLowerCase());
        p.style.display = tags.some(t=>t.includes(filter)) ? "" : "none";
    });
});
</script>
</body>
</html>