<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AUTODANCE SHARE ONLINE</title>
<style>
@font-face { font-family:'TungstenBold'; src:url('Tungsten-Bold.ttf') format('truetype'); }

body {
    font-family: Arial, sans-serif;
    background: url('IMG_2223.jpeg') no-repeat center center fixed;
    background-size: cover;
    margin:0; padding:0;
    color:#fff;
    overflow-x:hidden;
}

header {
    font-family:'TungstenBold', Arial,sans-serif;
    font-weight: normal;
    background: rgba(255,77,77,0.3);
    padding: 1em 1.5em;
    display:flex;
    align-items:center;
    justify-content: space-between;
    box-shadow:0 4px 6px rgba(0,0,0,0.3);
}

header h1 { 
    margin:0; 
    font-size:2.2em;
    letter-spacing:2px;
}

#hamburger {
    width:30px; height:20px; cursor:pointer; display:flex; flex-direction:column; justify-content:space-between;
}
#hamburger div { height:4px; background:#ffbb33; border-radius:2px; transition:0.3s; }

main {
    max-width:900px;
    margin:2em auto;
    padding:2em;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(8px);
    border-radius:16px;
}

h2 { color:#ffbb33; margin-top:1.5em; }

input, button {
    font-size:1em; border-radius:12px; border:none; padding:0.8em; margin-bottom:0.5em;
}
input[type="text"], input[type="url"], input[type="email"], input[type="password"] {
    width:100%;
    background: rgba(255,255,255,0.1);
    color:#fff;
    border:1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(6px);
    transition: border 0.3s, background 0.3s;
}
input::placeholder { color:#ccc; }
input:focus { border:1px solid #ffbb33; background: rgba(255,255,255,0.2); outline:none; }

button {
    background: linear-gradient(135deg,#ff4d4d,#ffbb33);
    color: #fff;
    font-weight:bold;
    cursor:pointer;
    transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
    padding:0.8em 1.5em;
}
button:hover {
    transform: scale(1.05);
    box-shadow:0 8px 20px rgba(255,187,51,0.6);
    background: linear-gradient(135deg,#ffbb33,#ff4d4d);
}

.post { background: rgba(30,30,30,0.4); backdrop-filter: blur(8px); padding:1em; border-radius:12px; margin-bottom:1em; box-shadow:0 8px 20px rgba(0,0,0,0.5); transition: transform 0.2s, box-shadow 0.2s; position: relative;}
.post:hover { transform: translateY(-3px); box-shadow:0 12px 28px rgba(0,0,0,0.6);}
.author { font-weight:bold; color:#ffbb33; margin-bottom:0.5em; display:flex; align-items:center; gap:8px;}
.author img { width:32px; height:32px; border-radius:50%; object-fit:cover; }
.video-container { position:relative; width:100%; height:0; padding-bottom:56.25%; margin-top:0.5em; }
.video-container iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; border-radius:8px;}
.delete-btn { margin-top:0.5em; background:#ff5555; color:#fff; border:none; padding:0.5em 1em; border-radius:8px; cursor:pointer; transition: background 0.3s, transform 0.2s;}
.delete-btn:hover { background:#e04343; transform: scale(1.05);}
.post.own { border:2px solid #ffbb33;}
.tag-box { font-family:'TungstenBold',Arial,sans-serif; display:inline-block; background:rgba(255,187,51,0.2); color:#ffbb33; padding:4px 10px; margin:3px 3px 0 0; border-radius:8px; font-size:0.85em; cursor:pointer; }

#avatarList { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:1em; }
#avatarList img { width:50px; height:50px; border-radius:50%; object-fit:cover; cursor:pointer; border:2px solid transparent; transition:border 0.2s;}
#avatarList img.selected { border-color:#ffbb33; }

/* Menu lateral */
#menuContent {
    position: fixed; top:0; right:-300px;
    width:250px; height:100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(6px);
    padding:1em;
    box-shadow: -4px 0 12px rgba(0,0,0,0.5);
    transition: right 0.3s;
    z-index: 1001;
}
#menuContent.show { right:0; }

#menuOverlay {
    position: fixed; top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(2px);
    opacity:0; pointer-events:none;
    transition: opacity 0.3s;
    z-index:1000;
}
#menuOverlay.show { opacity:1; pointer-events:auto; }

.menu-btn { display:block; margin-top:1em; background:#ffbb33; color:#000; width:100%; border-radius:8px; padding:0.6em; text-align:center; cursor:pointer;}
.menu-btn:hover { background:#ffdd66; }
</style>
</head>
<body>
<header>
<h1>AUTODANCE SHARE ONLINE</h1>
<div id="hamburger"><div></div><div></div><div></div></div>
</header>

<div id="menuOverlay"></div>

<div id="menuContent">
    <h2>Perfil</h2>
    <div id="menuAvatar" style="display:flex; align-items:center; gap:10px;">
      <img src="" style="width:80px;height:80px;border-radius:50%;object-fit:cover;">
      <span id="menuAvatarName" style="font-family:'TungstenBold',Arial,sans-serif; color:#ffbb33;"></span>
    </div>
    <div>
        <h3>Alterar Avatar</h3>
        <div id="avatarListMenu"></div>
    </div>
    <button class="menu-btn" id="logoutBtn">Logout</button>
</div>

<main>
<h2>Login / Registro</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">
<button id="loginBtn">Login / Criar conta</button>

<h2>Escolha seu avatar</h2>
<div id="avatarList"></div>

<h2>Poste sua autodance</h2>
<input type="text" id="author" placeholder="Seu nome" disabled>
<input type="url" id="videoUrl" placeholder="Cole o embed do Streamable (src)" disabled>
<input type="text" id="tags" placeholder="Tags (ex: Just Dance 2015, Solo, Funk)" disabled>
<button id="postBtn" disabled>Postar</button>

<h2>Pesquisar por tag</h2>
<input type="text" id="searchInput" placeholder="Pesquisar tag...">

<h2>Autodances enviadas</h2>
<div id="posts"></div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, push, set, onValue, remove, get, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCA2XWZzavTNdHi_w8X5aASfBTfoLVsghY",
  authDomain: "auto-dance.firebaseapp.com",
  databaseURL: "https://auto-dance-default-rtdb.firebaseio.com",
  projectId: "auto-dance",
  storageBucket: "auto-dance.firebasestorage.app",
  messagingSenderId: "960760470726",
  appId: "1:960760470726:web:f5af55d01df6a2be0d4bc7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Elementos
const emailInput=document.getElementById("email");
const senhaInput=document.getElementById("senha");
const loginBtn=document.getElementById("loginBtn");
const authorInput=document.getElementById("author");
const videoInput=document.getElementById("videoUrl");
const tagsInput=document.getElementById("tags");
const postBtn=document.getElementById("postBtn");
const postsContainer=document.getElementById("posts");
const searchInput=document.getElementById("searchInput");
const avatarList=document.getElementById("avatarList");
const avatarListMenu=document.getElementById("avatarListMenu");
const menuAvatar=document.querySelector("#menuAvatar img");
const menuAvatarName=document.getElementById("menuAvatarName");
const logoutBtn=document.getElementById("logoutBtn");
const hamburger=document.getElementById("hamburger");
const menuContent=document.getElementById("menuContent");
const menuOverlay=document.getElementById("menuOverlay");

let currentUser=null;
let selectedAvatar=null;
const blockedWords=["puta","merda","caralho","bosta","porra","foda","fodase","fuck","shit","bitch","asshole","damn","dick","piss","crap","cunt","coño","gilipollas","joder","cabron","merde","putain","con","connard","salope","bordel","nigger","nigga","slut","whore","fag","retard"];

// Monta seleção de avatar na tela principal e menu
function buildAvatarList(listEl){
    listEl.innerHTML="";
    const img=document.createElement("img");
    img.src="https://raphamodelagem3d-lab.github.io/Login/";
    img.onclick=()=> updateUserAvatar(img.src);
    listEl.appendChild(img);
}
buildAvatarList(avatarList);
buildAvatarList(avatarListMenu);

// Atualiza avatar
function updateUserAvatar(url){
    selectedAvatar=url;
    if(currentUser) update(ref(db,"users/"+currentUser.uid),{avatar:selectedAvatar});
    menuAvatar.src=selectedAvatar;
    const posts=postsContainer.querySelectorAll(".post.own .author img");
    posts.forEach(img=>img.src=selectedAvatar);
}

// Login / criar conta
loginBtn.addEventListener("click", async ()=>{
    const email=emailInput.value.trim();
    const senha=senhaInput.value.trim();
    if(!email||!senha){ alert("Preencha email e senha!"); return; }
    try{ await signInWithEmailAndPassword(auth,email,senha); }
    catch(e){ 
        try{ await createUserWithEmailAndPassword(auth,email,senha); }
        catch(err){ alert(err.message); return; }
    }
});

// Detecta login
onAuthStateChanged(auth, async user=>{
    if(user){
        currentUser=user;
        emailInput.disabled=true;
        senhaInput.disabled=true;
        loginBtn.disabled=true;
        authorInput.disabled=false;
        videoInput.disabled=false;
        tagsInput.disabled=false;
        postBtn.disabled=false;

        const userRef=ref(db,"users/"+user.uid);
        const snapshot=await get(userRef);
        let storedName="";
        if(snapshot.exists()){
            const val=snapshot.val();
            if(val.name){
                storedName=val.name;
                authorInput.value=storedName;
                authorInput.disabled = true; // trava definitivamente
            }
            if(val.avatar){
                selectedAvatar=val.avatar;
                menuAvatar.src=selectedAvatar;
            }
        }
        menuAvatarName.textContent=storedName;

        loadPosts();
    } else {
        currentUser=null;
        emailInput.disabled=false;
        senhaInput.disabled=false;
        loginBtn.disabled=false;
        authorInput.disabled=true;
        videoInput.disabled=true;
        tagsInput.disabled=true;
        postBtn.disabled=true;
        postsContainer.innerHTML="";
        menuAvatar.src="";
        menuAvatarName.textContent="";
    }
});

// Adiciona post
postBtn.addEventListener("click", async ()=>{
    if(!currentUser) return;

    const userRef = ref(db,"users/"+currentUser.uid);
    const snapshot = await get(userRef);
    let storedName = "";
    if(snapshot.exists()) storedName = snapshot.val().name || "";

    let author = storedName;
    if(!author){
        author = authorInput.value.trim();
        if(!author){ alert("Digite seu nome!"); return; }
        await update(userRef,{name:author});
        authorInput.value = author;
        authorInput.disabled = true;
        menuAvatarName.textContent = author;
    } else {
        authorInput.value = author; // força usar nome cadastrado
    }

    const video = videoInput.value.trim();
    const tags = tagsInput.value.trim().split(",").map(t=>t.trim()).filter(t=>t);

    if(!selectedAvatar){ alert("Selecione um avatar!"); return; }
    if(!video.includes("streamable.com")){ alert("Só vídeos do Streamable são permitidos!"); return; }
    if(tags.some(t=>blockedWords.some(w=>t.toLowerCase().includes(w)))){ alert("Tags impróprias não são permitidas!"); return; }

    const postRef = push(ref(db,"posts"));
    await set(postRef,{author,avatar:selectedAvatar,video,tags,uid:currentUser.uid});

    videoInput.value = "";
    tagsInput.value = "";
});

// Carrega posts
function loadPosts(){
    onValue(ref(db,"posts"),snapshot=>{
        postsContainer.innerHTML="";
        const data=snapshot.val();
        if(!data) return;
        Object.entries(data).reverse().forEach(([key,post])=>{
            const div=document.createElement("div");
            div.className="post";
            if(currentUser && post.uid===currentUser.uid) div.classList.add("own");
            div.innerHTML=`
                <div class="author"><img src="${post.avatar}">${post.author}:</div>
                <div class="video-container"><iframe src="${post.video}" allowfullscreen></iframe></div>
            `;
            if(post.tags&&post.tags.length){
                const tagsContainer=document.createElement("div");
                tagsContainer.style.marginTop="0.5em";
                post.tags.forEach(tag=>{
                    const tagBox=document.createElement("span");
                    tagBox.className="tag-box";
                    tagBox.textContent=tag;
                    tagsContainer.appendChild(tagBox);
                });
                div.appendChild(tagsContainer);
            }
            if(currentUser && post.uid===currentUser.uid){
                const delBtn=document.createElement("button");
                delBtn.textContent="Excluir";
                delBtn.className="delete-btn";
                delBtn.onclick=()=> remove(ref(db,"posts/"+key));
                div.appendChild(delBtn);
            }
            postsContainer.appendChild(div);
        });
    });
}

// Filtrar pesquisa
searchInput.addEventListener("input", ()=>{
    const filter=searchInput.value.trim().toLowerCase();
    const posts=postsContainer.querySelectorAll(".post");
    posts.forEach(p=>{
        const tags=Array.from(p.querySelectorAll(".tag-box")).map(t=>t.textContent.toLowerCase());
        p.style.display = tags.some(t=>t.includes(filter)) ? "" : "none";
    });
});

// Hamburger menu
hamburger.addEventListener("click", ()=>{
    menuContent.classList.toggle("show");
    menuOverlay.classList.toggle("show");
});
menuOverlay.addEventListener("click", ()=>{
    menuContent.classList.remove("show");
    menuOverlay.classList.remove("show");
});

// Logout
logoutBtn.addEventListener("click", async ()=>{
    if(currentUser){
        await signOut(auth);
        menuContent.classList.remove("show");
        menuOverlay.classList.remove("show");
    }
});
</script>
</body>
</html>